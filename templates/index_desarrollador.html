<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>K-I-B-O</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/Icon.png') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"
        defer></script>
</head>

<body>
    <div class="panel expanded">

        <div class="active-indicator"></div>
        <div class="panel-bg"></div>

        <div class="window-controls">
            <div class="btn btn-red"></div>
            <div class="btn btn-yellow"></div>
            <div class="btn btn-green"></div>
        </div>

        <div class="header">
            <div class="header-left">
                <div class="avatar-wrap">
                    <div class="avatar-border"></div>
                    <img class="avatar-img" src="{{ url_for('static', filename='images/VisualC.png') }}" alt="avatar"
                        id="user-avatar" />
                    <div class="avatar-status"></div>
                </div>
                <div class="user-meta">
                    <div class="user-name" id="user-name">Cargando...</div>
                    <div class="user-role" id="user-role">...</div>
                </div>
            </div>
            <div class="header-action" id="toggle-sidebar-btn">
                <div class="action-bg"></div>
                <div class="action-mark">
                    <i class="fa-solid fa-arrow-left"></i>
                </div>
            </div>
        </div>

        <div class="search-card">
            <div class="search-row">
                <div class="search-icon-placeholder">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </div>
                <div class="search-text">Search</div>
            </div>
        </div>

        <div class="nav-container">
            <div class="nav-card inicio" data-target="inicio">
                <div class="nav-card__icon"><i class="fa-solid fa-house"></i></div>
                <div class="nav-card__label">Inicio</div>
                <div class="nav-card__ornament"><i class="fa-solid fa-sliders"></i></div>
            </div>

            <div class="nav-card base-datos" data-target="database">
                <div class="nav-card__icon"><i class="fa-solid fa-database"></i>
                    <div class="nav-card__alert"></div>
                </div>
                <div class="nav-card__label">Base de Datos</div>
                <div class="nav-card__pill">1</div>
            </div>
            <div class="nav-card algoritmos" data-target="algoritmos">
                <div class="nav-card__icon"><i class="fa-solid fa-code-branch"></i></div>
                <div class="nav-card__label">Algoritmos</div>
                <div class="nav-card__ornament special"><i class="fa-solid fa-plus"></i></div>
            </div>
            <div class="nav-card usuarios" data-target="usuarios">
                <div class="nav-card__icon"><i class="fa-solid fa-users-gear"></i></div>
                <div class="nav-card__label">Usuarios</div>
                <div class="nav-card__pill">3</div>
            </div>
            <div class="nav-card configuracion" data-target="configuracion">
                <div class="nav-card__icon"><i class="fa-solid fa-cog"></i>
                    <div class="nav-card__alert"></div>
                </div>
                <div class="nav-card__label">Configuración</div>
                <div class="nav-card__pill">3</div>
            </div>
        </div>

        <div class="nav-card logout-button-container" id="logout-btn">
            <div class="nav-card__icon"><i class="fa-solid fa-right-from-bracket"></i></div>
            <div class="nav-card__label">Cerrar Sesión</div>
        </div>
    </div>

    <main class="main-content">
        <section id="inicio" class="content-section">
            <div class="welcome-header">
                <h2 id="welcome-message">¡Bienvenido de nuevo!</h2>
                <p>Aquí tienes un resumen del rendimiento del sistema y tu actividad reciente.</p>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-main-column">

                    <div class="dashboard-card">
                        <div class="card-header">
                            <i class="fa-solid fa-rocket"></i>
                            <h3>Rendimiento del Bot </h3>
                        </div>
                        <div class="card-body dev-stats-body">
                            <div class="stat-item">
                                <span class="stat-value"><small>s</small></span>
                                <span class="stat-label">Veloc. de Resp.</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="stats-queries-today">0</span>
                                <span class="stat-label">Consultas</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value"><small>%</small></span>
                                <span class="stat-label">Tasa de Éxito</span>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <i class="fa-solid fa-users"></i>
                            <h3>Usuarios Registrados</h3>
                        </div>
                        <div class="card-body" id="all-users-container">
                            <p class="empty-state">Cargando usuarios...</p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-side-column">

                    <div class="dashboard-card">
                        <div class="card-header">
                            <i class="fa-solid fa-chart-pie"></i>
                            <h3>Tus Estadísticas</h3>
                        </div>
                        <div class="card-body stats-body">
                            <div class="stat-item">
                                <span class="stat-value" id="stats-total-chats">0</span>
                                <span class="stat-label">Chats Totales</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-value" id="stats-unlocked-trophies">0</span>
                                <span class="stat-label">Logros</span>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <div class="card-header">
                            <i class="fa-solid fa-chart-donut"></i>
                            <h3>Distribución de Temas</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container-with-legend">
                                <div class="donut-chart-placeholder">
                                    <div class="donut-chart-center">
                                        <div class="total-value">0</div>
                                        <div class="total-label">Consultas</div>
                                    </div>
                                </div>
                                <ul class="chart-legend">
                                    <li class="legend-python">Python</li>
                                    <li class="legend-db">Base de Datos</li>
                                    <li class="legend-algo">Algoritmos</li>
                                    <li class="legend-other">General</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card tip-card">
                        <div class="card-header">
                            <i class="fa-solid fa-lightbulb"></i>
                            <h3>Sabías que...</h3>
                        </div>
                        <div class="card-body" id="tip-of-the-day-body">
                            <p>Puedes expandir y contraer el panel lateral haciendo clic en la flecha verde.</p>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <section id="chats" class="content-section">
            <div class="chat-interface">
                <header class="chat-header">
                    <div class="header-left"><button class="new-chat-btn"><i class="fa-solid fa-plus"></i> New
                            chat</button><button class="icon-btn"><i class="fa-solid fa-clock-rotate-left"></i></button>
                    </div>
                    <div class="header-right"><i class="fa-solid fa-wand-magic-sparkles"></i><label
                            class="switch"><input type="checkbox" checked><span class="slider round"></span></label><i
                            class="fa-regular fa-file-lines"></i><i class="fa-regular fa-bookmark"></i><i
                            class="fa-solid fa-link"></i></div>
                </header>
                <div class="chat-area" id="chat-messages"></div>
                <footer class="chat-input-area">
                    <div class="input-wrapper">
                        <textarea id="message-input" placeholder="Type a new message here"></textarea>
                        <div class="input-actions">
                            <button class="icon-btn" id="attach-file-btn"><i class="fa-solid fa-paperclip"></i></button>
                            <button class="icon-btn"><i class="fa-solid fa-face-smile"></i></button>
                            <button class="icon-btn" id="send-audio-btn"><i class="fa-solid fa-microphone"></i></button>
                            <button class="send-btn" id="send-btn"><i class="fa-solid fa-paper-plane"></i></button>
                        </div>
                    </div>
                </footer>
            </div>
        </section>

        <section id="database" class="content-section"></section>

        <section id="algoritmos" class="content-section">
            <div class="algoritmos-container">
                <div class="algoritmos-editor-panel">
                    <div class="editor-header">
                        <input type="text" id="algoritmo-title" placeholder="Título del Algoritmo..."
                            value="{{ algoritmo_titulo }}">
                        <button id="guardar-algoritmo-btn" class="save-btn">
                            <i class="fa-solid fa-save"></i> Guardar Cambios
                        </button>
                    </div>
                    <textarea id="algoritmo-description"
                        placeholder="Añade una breve descripción de lo que hace tu algoritmo...">{{ algoritmo_descripcion }}</textarea>
                    <div class="code-editor-container">
                        <div class="code-editor-header">
                            <span><i class="fa-brands fa-python"></i> {{ algoritmo_titulo }}</span>
                        </div>
                        <textarea id="algoritmo-code-input"
                            placeholder="Escribe tu código Python aquí...">{{ algoritmo_codigo }}</textarea>
                    </div>
                </div>
            </div>
        </section>

        <section id="usuarios" class="content-section">

            <div class="settings-container" style="max-width: 7000px; padding: 20px;">

                <h2>Gestión de Usuarios</h2>
                <div class="dashboard-grid" style="grid-template-columns: 2fr 1fr; gap: 25px;">

                    <div class="dashboard-main-column">
                        <div class="dashboard-card">

                            <div class="card-header">
                                <i class="fa-solid fa-user-plus"></i>
                                <h3>Creación de Cuentas</h3>
                            </div>

                            <div class="card-body" id="user-creation-container" style="padding: 0;">

                                <form id="signup-form"
                                    style="display: flex; flex-direction: column; gap: 18px; padding: 0 0 10px 0;"
                                    autocomplete="off">

                                    <div class="role-selector-compact">
                                        <input type="radio" id="role-alumno" name="role" value="alumno" checked>
                                        <label for="role-alumno" class="role-label-compact">Alumno</label>

                                        <input type="radio" id="role-profesor" name="role" value="profesor">
                                        <label for="role-profesor" class="role-label-compact">Profesor</label>

                                        <input type="radio" id="role-padre" name="role" value="padre">
                                        <label for="role-padre" class="role-label-compact">Padre</label>

                                        <input type="radio" id="role-desarrollador" name="role" value="desarrollador">
                                        <label for="role-desarrollador" class="role-label-compact">Desarrollador</label>
                                    </div>

                                    <div class="input-group-styled">
                                        <i class="fas fa-user icon-float"></i>
                                        <input type="text" id="signup-name" placeholder=" " required
                                            autocomplete="new-password" />
                                        <label for="signup-name">Nombre Completo</label>
                                    </div>

                                    <div class="input-group-styled">
                                        <i class="fas fa-envelope icon-float"></i>
                                        <input type="email" id="signup-email" placeholder=" " required
                                            autocomplete="new-password" />
                                        <label for="signup-email">Correo</label>
                                    </div>

                                    <div class="input-group-styled">
                                        <i class="fas fa-lock icon-float"></i>
                                        <input type="password" id="signup-password" placeholder=" " required
                                            autocomplete="new-password" />
                                        <label for="signup-password">Contraseña</label>
                                    </div>

                                    <button type="submit" class="btn-primary"
                                        style="margin-top: 15px; width: 100%; padding: 15px 0; font-size: 16px;">
                                        Crear Cuenta
                                    </button>
                                </form>

                                <div class="modal-overlay hidden" id="creation-success-modal">
                                    <div class="modal-content">
                                        <h3 id="success-modal-title" style="color: #50BB69;">✅ Cuenta Creada</h3>
                                        <p id="success-modal-message">El usuario ha sido registrado y puede iniciar
                                            sesión.</p>
                                        <div class="modal-actions">
                                            <button class="modal-button-confirm"
                                                id="close-success-modal-btn">Entendido</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-side-column">

                        <div class="dashboard-card" style="padding: 20px;">
                            <h3 style="color: #EBF0F5; margin-bottom: 15px;">
                                <i class="fa-solid fa-chalkboard-user" style="margin-right: 8px;"></i>Monitoreo por
                                Profesor
                            </h3>

                            <p style="color: #7D96B3; font-size: 0.9em; margin-bottom: 15px;">
                                Selecciona un perfil de profesor para ver a sus alumnos vinculados.
                            </p>

                            <div class="settings-input-group" style="margin-bottom: 20px;">
                                <label for="teacher-monitor-select"
                                    style="color: #EBF0F5; display: block; margin-bottom: 5px; font-size: 0.95em;">
                                    Elegir Profesor:
                                </label>
                                <select id="teacher-monitor-select"
                                    style="width: 100%; padding: 10px; background-color: #0A1C33; color: #EBF0F5; border: 1px solid #172E4D; border-radius: 8px;">
                                    <option value="">Cargando Profesores...</option>
                                </select>
                            </div>
                            <div id="students-grid-container"
                                style="display: grid; grid-template-columns: 1fr; gap: 20px; margin-top: 20px;">
                                <p class="empty-state">Selecciona un profesor para cargar la lista de alumnos.</p>
                            </div>
                        </div>

                        <div class="dashboard-card" style="margin-top: 20px; padding: 20px;">
                            <div class="link-section-container">
                                <h3><i class="fa-solid fa-link" style="color: #50BB69; margin-right: 10px;"></i>Vincular
                                    Estudiante Rápido</h3>
                                <p style="color: #7D96B3; font-size: 0.9rem; margin-bottom: 15px;">
                                    Asigna un estudiante por correo electrónico a un profesor específico.
                                </p>

                                <div class="settings-input-group" style="margin-bottom: 15px;">
                                    <label for="teacher-assign-select"
                                        style="color: #EBF0F5; display: block; margin-bottom: 5px; font-size: 0.95em;">
                                        Profesor a Asignar:
                                    </label>
                                    <select id="teacher-assign-select"
                                        style="width: 100%; padding: 10px; background-color: #0A1C33; color: #EBF0F5; border: 1px solid #172E4D; border-radius: 8px;">
                                        <option value="">Cargando Profesores...</option>
                                    </select>
                                </div>

                                <div class="big-input-wrapper" style="display: flex; gap: 10px;">
                                    <input type="email" id="link-student-email" placeholder="Correo del estudiante"
                                        style="flex-grow: 1;">
                                    <button id="btn-link-student" class="btn-primary" style="padding: 10px 15px;"><i
                                            class="fa-solid fa-plus"></i></button>
                                </div>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </section>

        <section id="configuracion" class="content-section">
            <div class="settings-container">
                <h2>Configuración de la Cuenta</h2>
                <div class="settings-card">
                    <h3>Perfil de Usuario</h3>
                    <div class="profile-settings-header">
                        <div class="avatar-settings-container">
                            <img src="{{ url_for('static', filename='images/VisualC.png') }}" id="settings-avatar"
                                alt="Avatar">
                            <label for="avatar-upload-input" class="edit-avatar-button" title="Cambiar avatar"><i
                                    class="fa-solid fa-camera"></i></label>
                            <input type="file" id="avatar-upload-input" accept="image/*" style="display: none;">
                        </div>
                        <div class="profile-inputs">
                            <div class="settings-input-group">
                                <label for="settings-name-input">Nombre de Usuario</label>
                                <input type="text" id="settings-name-input" placeholder="Tu nombre">
                            </div>
                            <div class="settings-input-group">
                                <label for="settings-email-input">Correo Electrónico</label>
                                <input type="email" id="settings-email-input" placeholder="tu@correo.com">
                            </div>
                        </div>
                    </div>
                    <div class="card-actions"><button id="save-profile-btn" class="btn-primary">Guardar Cambios</button>
                    </div>
                </div>
                <div class="settings-card">
                    <h3>Seguridad</h3>

                    <div class="settings-row">
                        <span>Cambiar Contraseña</span>
                        <button id="change-password-btn" class="btn-secondary">Cambiar</button>
                    </div>

                    <div class="modal-overlay hidden" id="change-password-modal-overlay">
                        <div class="modal-content">
                            <h3>Cambiar Contraseña</h3>
                            <p>Ingresa tu nueva contraseña para actualizar la seguridad de tu cuenta.</p>

                            <div class="settings-input-group">
                                <label for="new-password-input">Nueva Contraseña</label>
                                <input type="password" id="new-password-input" placeholder="Mínimo 6 caracteres"
                                    required>
                            </div>

                            <div class="settings-input-group">
                                <label for="confirm-password-input">Confirmar Contraseña</label>
                                <input type="password" id="confirm-password-input"
                                    placeholder="Confirma la nueva contraseña" required>
                            </div>

                            <div class="modal-actions">
                                <button class="modal-button-cancel" id="cancel-password-change-btn">Cancelar</button>
                                <button class="modal-button-confirm" id="confirm-password-change-btn">Actualizar
                                    Contraseña</button>
                            </div>

                            <div id="password-error-message"
                                style="color: #FF5E61; margin-top: 10px; display: none; font-size: 14px;"></div>
                        </div>
                    </div>
                </div>

                <div class="settings-card danger-zone">
                    <h3>Zona de Peligro</h3>
                    <div class="settings-row">
                        <div>
                            <h4>Eliminar Cuenta</h4>
                            <p>Esta acción es permanente y no se puede deshacer.</p>
                        </div>
                        <button id="delete-account-btn" class="btn-danger">Eliminar</button>
                    </div>

                    <div class="modal-overlay hidden" id="delete-account-modal-overlay">
                        <div class="modal-content">
                            <h3 style="color: #FF5E61;">⚠️ ¡Atención! Eliminar Cuenta</h3>
                            <p>Estás a punto de eliminar tu cuenta de forma **permanente**.</p>
                            <p style="color: #FF5E61; font-weight: 600;">Esta acción no se puede deshacer. ¿Estás
                                absolutamente seguro/a de continuar?</p>

                            <div class="modal-actions">
                                <button class="modal-button-cancel" id="cancel-delete-btn">Cancelar</button>
                                <button class="btn-danger" id="confirm-delete-btn">SÍ, Eliminar Permanentemente</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </section>
    </main>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>

    <script type="module" src="{{ url_for('static', filename='script.js') }}"></script>


</body>

</html>